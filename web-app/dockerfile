# 使用 Python 3.11 基础镜像
FROM python:3.11-slim

# 设置工作目录
WORKDIR /app

# 安装 pipenv
RUN pip install pipenv

# 复制 Pipfile 和 Pipfile.lock
COPY Pipfile Pipfile.lock ./

# 使用 pipenv 安装依赖，--system 标志会安装到系统 Python 而不是虚拟环境
RUN pipenv install --system --deploy

# 复制应用程序代码
COPY . .

# 暴露端口
EXPOSE 5000

# 设置环境变量
ENV FLASK_APP=run.py
ENV PYTHONUNBUFFERED=1

# 运行应用
CMD ["python", "run.py"]
